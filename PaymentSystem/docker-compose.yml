services:
  # PostgreSQL za WebShop
  postgres-webshop:
    image: postgres:15-alpine
    container_name: webshop-db
    environment:
      POSTGRES_DB: webshop
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: super
    ports:
      - "5434:5432"
    volumes:
      - postgres-webshop-data:/var/lib/postgresql/data

  # PostgreSQL za Banku
  postgres-bank:
    image: postgres:15-alpine
    container_name: bank-db
    environment:
      POSTGRES_DB: bank
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: super
    ports:
      - "5435:5432"
    volumes:
      - postgres-bank-data:/var/lib/postgresql/data

  # WebShop API 
  webshop-api:
    build:
      context: ./backend
      dockerfile: WebShop/WebShop.API/Dockerfile
    container_name: webshop-api
    depends_on:
      - postgres-webshop
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__WebShopDb=Host=postgres-webshop;Database=webshop;Username=postgres;Password=super;Port=5432
      - ASPNETCORE_URLS=http://+:80
    ports:
      - "5000:80"

  # Bank API 
  bank-api:
    build:
      context: ./backend
      dockerfile: Bank/Bank.API/Dockerfile
    container_name: bank-api
    depends_on:
      - postgres-bank
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__BankDb=Host=postgres-bank;Database=bank;Username=postgres;Password=super;Port=5432
      - ASPNETCORE_URLS=http://+:80
    ports:
      - "5001:80"

  # Vue Frontend za WebShop
  frontend-webshop:
    build:
      context: ./frontend/webshop
      dockerfile: Dockerfile
    container_name: frontend-webshop
    ports:
      - "5173:5173"
    volumes:
      - ./frontend/webshop:/app
      - /app/node_modules
    environment:
      - VITE_API_URL=http://localhost:5000
    depends_on:
      - webshop-api
    command: npm run dev -- --host 0.0.0.0

  # Vue Frontend za Banku
  frontend-bank:
    build:
      context: ./frontend/bank
      dockerfile: Dockerfile
    container_name: frontend-bank
    ports:
      - "5174:5173"
    volumes:
      - ./frontend/bank:/app
      - /app/node_modules
    environment:
      - VITE_API_URL=http://localhost:5001
    depends_on:
      - bank-api
    command: npm run dev -- --host 0.0.0.0

volumes:
  postgres-webshop-data:
  postgres-bank-data: